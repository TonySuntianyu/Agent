# åç«¯å¯åŠ¨æŒ‡å—

## ğŸ“‹ åç«¯æ¦‚è¿°

æœ¬é¡¹ç›®åç«¯æ˜¯åŸºäºFlaskçš„RESTful APIæœåŠ¡ï¼Œæä¾›å›¾ä¹¦æ¨èAgentçš„APIæ¥å£ã€‚

### åç«¯æ¶æ„
- **æ¡†æ¶**: Flask 2.0+
- **CORS**: æ”¯æŒè·¨åŸŸè¯·æ±‚
- **API**: RESTful APIè®¾è®¡
- **Agent**: åŸºäºLangGraphçš„å›¾ä¹¦æ¨èAgent

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨åç«¯

### æ–¹æ³•1ï¼šç›´æ¥å¯åŠ¨ï¼ˆæœ€ç®€å•ï¼‰

```bash
cd agent
python app.py
```

**å¯åŠ¨æˆåŠŸæ ‡å¿—**:
```
 * Running on http://127.0.0.1:5000
 * Debug mode: on
```

### æ–¹æ³•2ï¼šä½¿ç”¨Pythonæ¨¡å—æ–¹å¼

```bash
cd agent
python -m flask run
```

### æ–¹æ³•3ï¼šæŒ‡å®šç«¯å£å¯åŠ¨

ä¿®æ”¹ `app.py` æœ€åä¸€è¡Œï¼š
```python
if __name__ == '__main__':
    app.run(debug=True, port=8080, host='0.0.0.0')
```

---

## âš™ï¸ å¯åŠ¨å‰å‡†å¤‡

### 1. å®‰è£…ä¾èµ–

```bash
cd agent
pip install -r requirements.txt
```

**å…³é”®ä¾èµ–**:
- Flask >= 2.0.0
- Flask-Cors >= 3.0.0
- langchain >= 0.1.0
- langgraph >= 0.0.20
- å…¶ä»–Agentç›¸å…³ä¾èµ–

### 2. é…ç½®APIå¯†é’¥

#### æ–¹å¼Aï¼šç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰

**Windows (PowerShell)**:
```powershell
$env:DEEPSEEK_API_KEY = "your_deepseek_api_key_here"
$env:AGENT_MODEL = "deepseek-chat"
$env:DEEPSEEK_BASE_URL = "https://api.deepseek.com/v1"
```

**Linux/Mac**:
```bash
export DEEPSEEK_API_KEY="your_deepseek_api_key_here"
export AGENT_MODEL="deepseek-chat"
export DEEPSEEK_BASE_URL="https://api.deepseek.com/v1"
```

#### æ–¹å¼Bï¼šä¿®æ”¹é…ç½®æ–‡ä»¶

ç¼–è¾‘ `agent/config.py`:
```python
DEEPSEEK_API_KEY = "your_deepseek_api_key_here"
AGENT_MODEL = "deepseek-chat"
DEEPSEEK_BASE_URL = "https://api.deepseek.com/v1"
```

---

## ğŸ”Œ APIç«¯ç‚¹è¯´æ˜

### 1. GET `/`
**åŠŸèƒ½**: è¿”å›å‰ç«¯HTMLé¡µé¢

**è¯·æ±‚**:
```
GET http://localhost:5000/
```

**å“åº”**: HTMLé¡µé¢

---

### 2. POST `/chat`
**åŠŸèƒ½**: å¤„ç†ç”¨æˆ·èŠå¤©æ¶ˆæ¯

**è¯·æ±‚æ ¼å¼**:
```json
{
    "message": "æœç´¢ã€Šä¸‰ä½“ã€‹",
    "user_id": "user001"
}
```

**å“åº”æ ¼å¼**:
```json
{
    "response": "æ‰¾åˆ°äº†ã€Šä¸‰ä½“ã€‹çš„è¯¦ç»†ä¿¡æ¯..."
}
```

**cURLç¤ºä¾‹**:
```bash
curl -X POST http://localhost:5000/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "æœç´¢ã€Šä¸‰ä½“ã€‹", "user_id": "user001"}'
```

**Pythonç¤ºä¾‹**:
```python
import requests

response = requests.post(
    'http://localhost:5000/chat',
    json={
        'message': 'æœç´¢ã€Šä¸‰ä½“ã€‹',
        'user_id': 'user001'
    }
)
print(response.json())
```

---

### 3. POST `/recommend`
**åŠŸèƒ½**: è·å–å›¾ä¹¦æ¨è

**è¯·æ±‚æ ¼å¼**:
```json
{
    "book_title": "ä¸‰ä½“",
    "user_id": "user001"
}
```

**å“åº”æ ¼å¼**:
```json
{
    "recommendations": {
        "recommendations": [
            {
                "title": "æµæµªåœ°çƒ",
                "author": "åˆ˜æ…ˆæ¬£",
                "genre": "ç§‘å¹»",
                ...
            }
        ],
        "recommendation_reasons": [
            "åŒä½œè€… åˆ˜æ…ˆæ¬£ çš„å…¶ä»–ä½œå“"
        ]
    }
}
```

**cURLç¤ºä¾‹**:
```bash
curl -X POST http://localhost:5000/recommend \
  -H "Content-Type: application/json" \
  -d '{"book_title": "ä¸‰ä½“", "user_id": "user001"}'
```

### 4. POST `/feedback`
**åŠŸèƒ½**: è®°å½•ç”¨æˆ·å¯¹æ¨èä¹¦ç±çš„è¯„åˆ†æˆ–è¯„è®ºï¼Œä¸ºä¸‹ä¸€æ¬¡æ¨èæä¾›å‚è€ƒã€‚

**è¯·æ±‚æ ¼å¼**:
```json
{
    "user_id": "reader001",
    "book_title": "ä¸‰ä½“",
    "rating": 9.5,
    "comment": "ç¡¬ç§‘å¹»è®¾å®šå¾ˆå¯¹èƒƒå£"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "success": true,
    "message": "å·²è®°å½•æ‚¨å¯¹ã€Šä¸‰ä½“ã€‹çš„è¯„ä»·ï¼ˆ9.5 åˆ†ï¼‰ã€‚è¯„è®ºï¼šç¡¬ç§‘å¹»è®¾å®šå¾ˆå¯¹èƒƒå£"
}
```

### 4. GET `/welcome`
**åŠŸèƒ½**: è¿”å›æ¬¢è¿æ–‡æ¡ˆï¼Œä¾›å‰ç«¯åœ¨é¡µé¢åŠ è½½æ—¶å±•ç¤ºç³»ç»Ÿè¯´æ˜ã€‚

**è¯·æ±‚**:
```
GET http://localhost:5000/welcome
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "message": "ğŸ‘‹ æ¬¢è¿ä½¿ç”¨å›¾ä¹¦æ¨èAgentï¼..."
}
```

---

## ğŸ” éªŒè¯åç«¯å¯åŠ¨

### æ–¹æ³•1ï¼šæ£€æŸ¥å¯åŠ¨æ—¥å¿—

å¯åŠ¨ååº”è¯¥çœ‹åˆ°ï¼š
```
 * Serving Flask app 'app'
 * Debug mode: on
WARNING: This is a development server. Do not use it in a production deployment.
 * Running on http://127.0.0.1:5000
Press CTRL+C to quit
```

### æ–¹æ³•2ï¼šè®¿é—®æ ¹è·¯å¾„

åœ¨æµè§ˆå™¨è®¿é—®ï¼š
```
http://localhost:5000
```

åº”è¯¥çœ‹åˆ°å‰ç«¯é¡µé¢æˆ– "Book Recommendation Agent is running!"

### æ–¹æ³•3ï¼šæµ‹è¯•APIç«¯ç‚¹

ä½¿ç”¨curlæµ‹è¯•ï¼š
```bash
# æµ‹è¯•æ ¹è·¯å¾„
curl http://localhost:5000/

# æµ‹è¯•èŠå¤©æ¥å£
curl -X POST http://localhost:5000/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ä½ å¥½", "user_id": "test"}'
```

### æ–¹æ³•4ï¼šä½¿ç”¨Pythonæµ‹è¯•

```python
import requests

# æµ‹è¯•åç«¯æ˜¯å¦è¿è¡Œ
try:
    response = requests.get('http://localhost:5000/')
    print(f"âœ… åç«¯è¿è¡Œæ­£å¸¸: {response.status_code}")
except Exception as e:
    print(f"âŒ åç«¯æœªè¿è¡Œ: {e}")
```

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: ç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯**: `Address already in use`

**è§£å†³æ–¹æ¡ˆ**:

**Windows**:
```powershell
# æŸ¥æ‰¾å ç”¨5000ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr :5000

# ç»“æŸè¿›ç¨‹ï¼ˆæ›¿æ¢PIDä¸ºå®é™…è¿›ç¨‹IDï¼‰
taskkill /PID <PID> /F
```

**Linux/Mac**:
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :5000

# ç»“æŸè¿›ç¨‹
kill -9 <PID>
```

**æˆ–ä¿®æ”¹ç«¯å£**:
```python
# åœ¨app.pyä¸­
app.run(debug=True, port=8080)
```

---

### é—®é¢˜2: æ¨¡å—å¯¼å…¥é”™è¯¯

**é”™è¯¯ä¿¡æ¯**: `ModuleNotFoundError: No module named 'flask'`

**è§£å†³æ–¹æ¡ˆ**:
```bash
pip install -r requirements.txt
```

---

### é—®é¢˜3: APIå¯†é’¥é”™è¯¯

**é”™è¯¯ä¿¡æ¯**: `è¯·è®¾ç½®DeepSeek APIå¯†é’¥`

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®
2. ç¡®è®¤ `config.py` ä¸­çš„é…ç½®
3. éªŒè¯APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ

---

### é—®é¢˜4: Agentåˆå§‹åŒ–å¤±è´¥

**é”™è¯¯ä¿¡æ¯**: `Failed to initialize agent`

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥æ‰€æœ‰ä¾èµ–æ˜¯å¦å®‰è£…
2. ç¡®è®¤ `book_agent.py` åŠç›¸å…³æ–‡ä»¶å­˜åœ¨
3. æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

---

### é—®é¢˜5: CORSé”™è¯¯

**é”™è¯¯ä¿¡æ¯**: `CORS policy: No 'Access-Control-Allow-Origin'`

**è§£å†³æ–¹æ¡ˆ**:
ç¡®è®¤ `app.py` ä¸­å·²å¯ç”¨CORSï¼š
```python
from flask_cors import CORS
CORS(app)
```

---

## ğŸ”§ é«˜çº§é…ç½®

### ä¿®æ”¹è¿è¡Œé…ç½®

ç¼–è¾‘ `app.py`:

```python
if __name__ == '__main__':
    app.run(
        debug=True,           # è°ƒè¯•æ¨¡å¼
        host='0.0.0.0',       # å…è®¸å¤–éƒ¨è®¿é—®
        port=5000,            # ç«¯å£å·
        threaded=True         # å¤šçº¿ç¨‹æ”¯æŒ
    )
```

### ç”Ÿäº§ç¯å¢ƒé…ç½®

**ä½¿ç”¨Gunicorn**:
```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 app:app
```

**ä½¿ç”¨uWSGI**:
```bash
pip install uwsgi
uwsgi --http :5000 --wsgi-file app.py --callable app
```

---

## ğŸ“Š åç«¯æœåŠ¡çŠ¶æ€æ£€æŸ¥

### å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼ˆå¯é€‰ï¼‰

å¯ä»¥åœ¨ `app.py` ä¸­æ·»åŠ ï¼š

```python
@app.route('/health')
def health():
    """å¥åº·æ£€æŸ¥ç«¯ç‚¹"""
    return jsonify({
        'status': 'healthy',
        'service': 'Book Recommendation Agent',
        'version': '1.0.0'
    })
```

ç„¶åè®¿é—®ï¼š
```
http://localhost:5000/health
```

---

## ğŸš€ å¯åŠ¨è„šæœ¬ç¤ºä¾‹

### Windowsæ‰¹å¤„ç†è„šæœ¬

åˆ›å»º `start_backend.bat`:
```batch
@echo off
cd agent
set DEEPSEEK_API_KEY=your_api_key_here
python app.py
pause
```

### Linux/Mac Shellè„šæœ¬

åˆ›å»º `start_backend.sh`:
```bash
#!/bin/bash
cd agent
export DEEPSEEK_API_KEY="your_api_key_here"
export AGENT_MODEL="deepseek-chat"
export DEEPSEEK_BASE_URL="https://api.deepseek.com/v1"
python app.py
```

ä½¿ç”¨ï¼š
```bash
chmod +x start_backend.sh
./start_backend.sh
```

---

## ğŸ“ å¯åŠ¨æ£€æŸ¥æ¸…å•

å¯åŠ¨åç«¯å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] Python 3.8+ å·²å®‰è£…
- [ ] æ‰€æœ‰ä¾èµ–åŒ…å·²å®‰è£…
- [ ] APIå¯†é’¥å·²é…ç½®
- [ ] ç«¯å£5000æœªè¢«å ç”¨
- [ ] ç½‘ç»œè¿æ¥æ­£å¸¸
- [ ] ç›¸å…³æ–‡ä»¶å®Œæ•´ï¼ˆapp.py, book_agent.pyç­‰ï¼‰

---

## ğŸ¯ å®Œæ•´å¯åŠ¨æµç¨‹

### æ­¥éª¤1: è¿›å…¥ç›®å½•
```bash
cd agent
```

### æ­¥éª¤2: å®‰è£…ä¾èµ–ï¼ˆå¦‚æœªå®‰è£…ï¼‰
```bash
pip install -r requirements.txt
```

### æ­¥éª¤3: é…ç½®APIå¯†é’¥
```bash
# Windows
$env:DEEPSEEK_API_KEY = "your_key"

# Linux/Mac
export DEEPSEEK_API_KEY="your_key"
```

### æ­¥éª¤4: å¯åŠ¨åç«¯
```bash
python app.py
```

### æ­¥éª¤5: éªŒè¯å¯åŠ¨
è®¿é—® `http://localhost:5000` æˆ–æµ‹è¯•APIç«¯ç‚¹

---

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### 1. åå°è¿è¡Œ

**Linux/Mac**:
```bash
nohup python app.py > app.log 2>&1 &
```

**Windows**:
ä½¿ç”¨ä»»åŠ¡è®¡åˆ’ç¨‹åºæˆ–å¯åŠ¨ä¸ºæœåŠ¡

### 2. æŸ¥çœ‹æ—¥å¿—

å¯åŠ¨æ—¶ä¼šæ˜¾ç¤ºè¯¦ç»†æ—¥å¿—ï¼ŒåŒ…æ‹¬ï¼š
- è¯·æ±‚ä¿¡æ¯
- é”™è¯¯ä¿¡æ¯
- Agentå¤„ç†è¿‡ç¨‹

### 3. è°ƒè¯•æ¨¡å¼

`debug=True` æ—¶ï¼š
- è‡ªåŠ¨é‡è½½ä»£ç æ›´æ”¹
- æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
- å¯ç”¨è°ƒè¯•å™¨

**æ³¨æ„**: ç”Ÿäº§ç¯å¢ƒè¯·å…³é—­debugæ¨¡å¼

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼š
1. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
2. æ£€æŸ¥é…ç½®æ–‡ä»¶
3. éªŒè¯ä¾èµ–å®‰è£…
4. å‚è€ƒé¡¹ç›®æ–‡æ¡£

---

**æœ€åæ›´æ–°**: 2024å¹´12æœˆ

