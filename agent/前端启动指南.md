# 前端启动指南

## 📋 概述

本项目的前端是一个基于Flask的Web应用，包含：
- **后端**: Flask API服务器（提供RESTful API）
- **前端**: HTML + CSS + JavaScript（静态文件）

## 🚀 快速启动

### 方法1: 使用Flask内置服务器（推荐）

#### 步骤1: 安装依赖

```bash
cd agent
pip install -r requirements.txt
```

确保已安装以下关键依赖：
- Flask >= 2.0.0
- Flask-Cors >= 3.0.0
- 其他Agent相关依赖

#### 步骤2: 配置环境变量

确保已设置AI API密钥（DeepSeek、OpenAI或Gemini）：

```bash
# 方式1: 设置环境变量
export DEEPSEEK_API_KEY="your_api_key_here"
export AGENT_MODEL="deepseek-chat"
export DEEPSEEK_BASE_URL="https://api.deepseek.com"

# 方式2: 或使用config.py中的配置
```

#### 步骤3: 启动Flask服务器

```bash
cd agent
python app.py
```

#### 步骤4: 访问前端界面

在浏览器中打开：
```
http://localhost:5000
```

或

```
http://127.0.0.1:5000
```

### 方法2: 使用Python启动脚本

```bash
cd agent
python start_agent.py
```

注意：`start_agent.py` 是命令行交互版本，不是Web版本。

## 📁 文件结构

```
agent/
├── app.py              # Flask后端服务器
├── index.html          # 前端HTML页面
├── style.css           # 前端样式文件
├── script.js           # 前端JavaScript逻辑
├── book_agent.py       # Agent核心逻辑
└── requirements.txt    # Python依赖包
```

## 🔧 配置说明

### 后端配置（app.py）

```python
# Flask应用配置
app = Flask(__name__, static_folder='.', static_url_path='')
CORS(app)  # 启用跨域支持

# Agent实例
agent = BookRecommendationAgent()
```

### 前端配置（script.js）

```javascript
// API服务器地址
const API_URL = 'http://127.0.0.1:5000';
```

如果需要修改端口或地址，需要同时修改：
1. `app.py` 中的 `app.run(port=5000)`
2. `script.js` 中的 `API_URL`

## 🌐 API端点

### 1. GET `/`
返回前端HTML页面

### 2. POST `/chat`
处理用户聊天消息

**请求格式**:
```json
{
    "message": "搜索《三体》",
    "user_id": "user001"
}
```

**响应格式**:
```json
{
    "response": "找到了《三体》的详细信息..."
}
```

### 3. POST `/recommend`
获取图书推荐

**请求格式**:
```json
{
    "book_title": "三体",
    "user_id": "user001"
}
```

**响应格式**:
```json
{
    "recommendations": {
        "recommendations": [...],
        "recommendation_reasons": [...]
    }
}
```

### 4. GET `/welcome`
返回欢迎文案，供前端在页面加载时展示提示信息。

```json
{
    "message": "👋 欢迎使用图书推荐Agent！..."
}
```

## 🎨 前端功能

### 主要功能
- ✅ 实时聊天界面
- ✅ 图书搜索
- ✅ 图书推荐
- ✅ 用户交互反馈
- ✅ 多会话记录（新建 / 重命名 / 删除）
- ✅ “正在生成中”状态提示与自动欢迎词

### 界面特性
- 渐变主题 + 95vw 宽屏卡片布局
- 响应式布局，适配桌面与平板
- 实时消息显示 + 打字动画状态指示
- 错误处理提示 & 输入禁用防抖

## 🐛 常见问题

### 问题1: 无法访问前端页面

**症状**: 浏览器显示"无法访问此网站"

**解决方案**:
1. 确认Flask服务器正在运行
2. 检查端口5000是否被占用
3. 尝试使用 `http://127.0.0.1:5000` 而不是 `http://localhost:5000`

### 问题2: API请求失败

**症状**: 前端显示连接错误

**解决方案**:
1. 检查 `script.js` 中的 `API_URL` 是否正确
2. 确认Flask服务器的CORS已启用
3. 查看浏览器控制台的错误信息
4. 检查后端日志是否有错误

### 问题3: 依赖包缺失

**症状**: 启动时提示模块未找到

**解决方案**:
```bash
pip install -r requirements.txt
```

### 问题4: API密钥未设置

**症状**: Agent无法正常工作

**解决方案**:
```bash
# 设置环境变量
export DEEPSEEK_API_KEY="your_api_key"
# 或修改 config.py
```

## 🔍 调试技巧

### 1. 查看后端日志

Flask默认开启debug模式，会在控制台显示详细错误信息。

### 2. 查看浏览器控制台

按 `F12` 打开开发者工具，查看：
- Console: JavaScript错误
- Network: API请求状态

### 3. 测试API端点

使用curl测试API：

```bash
# 测试聊天接口
curl -X POST http://localhost:5000/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "搜索《三体》", "user_id": "test_user"}'
```

## 📝 开发建议

### 修改端口

如果需要修改端口，编辑 `app.py`:

```python
if __name__ == '__main__':
    app.run(debug=True, port=8080)  # 修改为8080端口
```

同时修改 `script.js`:

```javascript
const API_URL = 'http://127.0.0.1:8080';  # 对应修改
```

### 添加新功能

1. **添加新的API端点**：在 `app.py` 中添加新的路由
2. **修改前端界面**：编辑 `index.html` 和 `style.css`
3. **添加前端逻辑**：在 `script.js` 中添加新功能

## 🚀 生产环境部署

### 使用Gunicorn

```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 app:app
```

### 使用Nginx反向代理

配置Nginx将请求转发到Flask应用。

## 📞 技术支持

如遇问题，请：
1. 查看错误日志
2. 检查配置文件
3. 参考项目文档
4. 提交Issue

---

**最后更新**: 2024年12月

